---
prerequisite_packages:
  - fedora-workstation-repositories
  - https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
  - https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm

pre_install:
  run:
    - flatpak remote-modify fedora --disable
    - flatpak remote-modify fedora-testing --disable
    - >
      grep 'max_parallel_downloads=10' /etc/dnf/dnf.conf ||
      echo 'max_parallel_downloads=10' |
      sudo tee -a /etc/dnf/dnf.conf
    - >
      grep 'defaultyes=True' /etc/dnf/dnf.conf ||
      echo 'defaultyes=True' |
      sudo tee -a /etc/dnf/dnf.conf
    - sudo dnf update @core -y
    - sudo grubby --args="iommu=pt" --update-kernel=ALL
    - |
      function enable_iommu() {
          cpu_info=$(head -n 5 /proc/cpuinfo)

          if echo "$cpu_info" | grep -qi "vendor_id.*authenticamd"; then
              cpu="amd"
          elif echo "$cpu_info" | grep -qi "vendor_id.*genuineintel"; then
              cpu="intel"
          else
              return 1
          fi
          sudo grubby --args="${cpu}_iommu=on" --update-kernel=ALL
      }

      enable_iommu || exit 1

packages:
  # --setopt=install_weak_deps=False
  - bat
  - lsd
  - fontawesome-fonts-web
  - google-carlito-fonts
  - hddtemp
  - htop
  - lm_sensors
  - lshw
  - mediainfo
  - nvme-cli
  - openssh
  - openssl
  - p7zip
  - procinfo
  - procs
  - pv
  - smartmontools
  - package: util-linux-user
    purpose: Provides `chsh` to change to zsh
  - zsh
  - zsh-autosuggestions
  - zsh-syntax-highlighting

remove:
  - cheese
  - evince
  - firefox
  - firefox-langpacks
  - gnome-boxes
  - gnome-calendar
  - gnome-extensions-app
  - gnome-shell-extension-window-list
  - gnome-tour
  - gnome-photos
  - gnome-maps
  - gnome-help
  - abiword
  - mediawriter
  - fedora-chromium-config
  - blueman-nautilus
  - eog
